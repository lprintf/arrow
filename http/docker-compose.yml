services:
  backend:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: ${COMPOSE_PROJECT_NAME:-arrow-http}-backend
    volumes:
      - ../data:/app/data:ro
    environment:
      PYTHONUNBUFFERED: "1"
    networks:
      - gateway-http
    restart: unless-stopped

  frontend:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    container_name: ${COMPOSE_PROJECT_NAME:-arrow-http}-frontend
    environment:
      - BACKEND_HOST=${COMPOSE_PROJECT_NAME:-arrow-http}-backend
    depends_on:
      backend:
        condition: service_started
    networks:
      - gateway-http
    labels:
      - traefik.enable=true
      - traefik.http.routers.arrow.rule=Host(`arrow.${DOMAIN}`)
      - traefik.http.routers.arrow.entrypoints=web
      - traefik.http.routers.arrow.middlewares=strip-user-headers@file,oidc-auth@file
      - traefik.http.services.arrow.loadbalancer.server.port=80
    restart: unless-stopped

networks:
  gateway-http:
    external: true
